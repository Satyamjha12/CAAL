---
phase: 02-frontend-i18n
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/messages/en.json
  - frontend/messages/fr.json
  - frontend/components/settings/settings-panel.tsx
  - frontend/components/app/welcome-view.tsx
  - frontend/components/setup/setup-wizard.tsx
  - frontend/components/setup/provider-step.tsx
  - frontend/components/setup/stt-step.tsx
  - frontend/components/setup/integrations-step.tsx
autonomous: true

must_haves:
  truths:
    - "User sees all UI text in their configured language (EN or FR)"
    - "User can change language via dropdown in settings panel"
    - "Settings panel shows all labels, buttons, and descriptions in selected language"
    - "Language change saves to backend, updates cookie, and reloads page"
  artifacts:
    - path: "frontend/messages/en.json"
      provides: "English translations (reference)"
      min_lines: 100
    - path: "frontend/messages/fr.json"
      provides: "French translations"
      min_lines: 100
    - path: "frontend/components/settings/settings-panel.tsx"
      provides: "Localized settings panel with language selector"
      contains: "useTranslations"
  key_links:
    - from: "frontend/components/settings/settings-panel.tsx"
      to: "messages/en.json"
      via: "useTranslations hook"
      pattern: "const t = useTranslations\\("
    - from: "frontend/components/settings/settings-panel.tsx"
      to: "/api/settings"
      via: "language save and cookie update"
      pattern: "document\\.cookie.*CAAL_LOCALE"
---

<objective>
Create EN/FR message files and localize all user-facing UI components including the settings panel with language selector.

Purpose: Users can interact with the web UI entirely in their configured language. A language dropdown in settings allows changing the language, which saves to backend, updates the cookie, and reloads the page to apply.

Output: Complete frontend localization with EN/FR message files and all visible text using translations.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frontend-i18n/02-RESEARCH.md
@.planning/phases/02-frontend-i18n/02-CONTEXT.md
@.planning/phases/02-frontend-i18n/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EN/FR message files with all UI strings</name>
  <files>
    frontend/messages/en.json
    frontend/messages/fr.json
  </files>
  <action>
Create comprehensive message files with namespaced translations. Analyze all components to extract strings.

1. Create `frontend/messages/en.json` with namespaced structure:

```json
{
  "Common": {
    "save": "Save Changes",
    "saving": "Saving...",
    "loading": "Loading...",
    "test": "Test",
    "back": "Back",
    "continue": "Continue",
    "cancel": "Cancel",
    "close": "Close",
    "enabled": "Enabled",
    "disabled": "Disabled",
    "settings": "Settings"
  },
  "Welcome": {
    "subtitle": "Chat live with your voice AI agent",
    "start": "Start"
  },
  "Settings": {
    "title": "Settings",
    "tabs": {
      "agent": "Agent",
      "prompt": "Prompt",
      "providers": "Providers",
      "llm": "LLM Settings",
      "integrations": "Integrations",
      "wake": "Wake Word"
    },
    "language": {
      "label": "Language",
      "description": "Choose your preferred language",
      "updated": "Language updated"
    },
    "agent": {
      "name": "Agent Name",
      "voice": "Voice",
      "wakeGreetings": "Wake Greetings",
      "wakeGreetingsHint": "one per line"
    },
    "prompt": {
      "default": "Default",
      "custom": "Custom"
    },
    "providers": {
      "llmProvider": "LLM Provider",
      "ttsProvider": "TTS Provider",
      "hostUrl": "Host URL",
      "apiKey": "API Key",
      "model": "Model",
      "selectModel": "Select a model...",
      "modelsAvailable": "{count} models available",
      "testConnectionToSee": "Test connection to see all available models",
      "enterApiKeyToSee": "Enter API key and test to see all available models",
      "getApiKeyAt": "Get your API key at",
      "sttProvider": "STT Provider",
      "sttProviderNote": "Automatically selected based on LLM provider.",
      "speachesLocal": "Speaches (local)",
      "groqWhisper": "Groq Whisper",
      "kokoroDesc": "High-quality neural TTS (requires Kokoro container)",
      "piperDesc": "Lightweight CPU-friendly TTS with 35+ languages"
    },
    "llm": {
      "temperature": "Temperature",
      "precise": "Precise",
      "creative": "Creative",
      "contextSize": "Context Size",
      "maxTurns": "Max Turns",
      "toolCacheSize": "Tool Cache Size",
      "turnDetection": "Turn Detection",
      "turnDetectionDesc": "Control how the agent detects when you're done speaking",
      "allowInterruptions": "Allow Interruptions",
      "allowInterruptionsDesc": "Interrupt the agent while speaking",
      "endpointingDelay": "Endpointing Delay",
      "endpointingDelayDesc": "How long to wait after you stop speaking before responding"
    },
    "integrations": {
      "homeAssistant": "Home Assistant",
      "n8n": "n8n",
      "longLivedToken": "Long-lived Access Token",
      "accessToken": "Access Token",
      "connected": "Connected",
      "entities": "{count} entities",
      "mcpNote": "/mcp-server/http will be appended automatically"
    },
    "wake": {
      "enable": "Enable Wake Word",
      "model": "Wake Word Model",
      "threshold": "Threshold",
      "silenceTimeout": "Silence Timeout (s)"
    },
    "errors": {
      "loadFailed": "Failed to load settings",
      "saveFailed": "Failed to save",
      "connectionFailed": "Connection failed",
      "invalidApiKey": "Invalid API key"
    },
    "status": {
      "downloadingVoice": "Downloading voice model..."
    }
  },
  "Setup": {
    "welcome": "Welcome to CAAL",
    "stepOf": "Step {current} of {total}",
    "step1Title": "Choose your AI provider",
    "step2Title": "Choose your voice",
    "step3Title": "Configure integrations",
    "finishSetup": "Finish Setup"
  }
}
```

2. Create `frontend/messages/fr.json` with French translations:

```json
{
  "Common": {
    "save": "Enregistrer",
    "saving": "Enregistrement...",
    "loading": "Chargement...",
    "test": "Tester",
    "back": "Retour",
    "continue": "Continuer",
    "cancel": "Annuler",
    "close": "Fermer",
    "enabled": "Activé",
    "disabled": "Désactivé",
    "settings": "Paramètres"
  },
  "Welcome": {
    "subtitle": "Discutez en direct avec votre assistant vocal IA",
    "start": "Démarrer"
  },
  "Settings": {
    "title": "Paramètres",
    "tabs": {
      "agent": "Agent",
      "prompt": "Prompt",
      "providers": "Fournisseurs",
      "llm": "Paramètres LLM",
      "integrations": "Intégrations",
      "wake": "Mot d'activation"
    },
    "language": {
      "label": "Langue",
      "description": "Choisissez votre langue préférée",
      "updated": "Langue mise à jour"
    },
    "agent": {
      "name": "Nom de l'agent",
      "voice": "Voix",
      "wakeGreetings": "Messages d'accueil",
      "wakeGreetingsHint": "un par ligne"
    },
    "prompt": {
      "default": "Par défaut",
      "custom": "Personnalisé"
    },
    "providers": {
      "llmProvider": "Fournisseur LLM",
      "ttsProvider": "Fournisseur TTS",
      "hostUrl": "URL de l'hôte",
      "apiKey": "Clé API",
      "model": "Modèle",
      "selectModel": "Sélectionner un modèle...",
      "modelsAvailable": "{count} modèles disponibles",
      "testConnectionToSee": "Testez la connexion pour voir tous les modèles disponibles",
      "enterApiKeyToSee": "Entrez la clé API et testez pour voir tous les modèles disponibles",
      "getApiKeyAt": "Obtenez votre clé API sur",
      "sttProvider": "Fournisseur STT",
      "sttProviderNote": "Sélectionné automatiquement selon le fournisseur LLM.",
      "speachesLocal": "Speaches (local)",
      "groqWhisper": "Groq Whisper",
      "kokoroDesc": "TTS neuronal haute qualité (nécessite le conteneur Kokoro)",
      "piperDesc": "TTS léger compatible CPU avec plus de 35 langues"
    },
    "llm": {
      "temperature": "Température",
      "precise": "Précis",
      "creative": "Créatif",
      "contextSize": "Taille du contexte",
      "maxTurns": "Tours maximum",
      "toolCacheSize": "Taille du cache d'outils",
      "turnDetection": "Détection de tour",
      "turnDetectionDesc": "Contrôle comment l'agent détecte quand vous avez fini de parler",
      "allowInterruptions": "Autoriser les interruptions",
      "allowInterruptionsDesc": "Interrompre l'agent pendant qu'il parle",
      "endpointingDelay": "Délai de fin",
      "endpointingDelayDesc": "Temps d'attente après que vous arrêtez de parler avant de répondre"
    },
    "integrations": {
      "homeAssistant": "Home Assistant",
      "n8n": "n8n",
      "longLivedToken": "Jeton d'accès longue durée",
      "accessToken": "Jeton d'accès",
      "connected": "Connecté",
      "entities": "{count} entités",
      "mcpNote": "/mcp-server/http sera ajouté automatiquement"
    },
    "wake": {
      "enable": "Activer le mot d'activation",
      "model": "Modèle de mot d'activation",
      "threshold": "Seuil",
      "silenceTimeout": "Délai de silence (s)"
    },
    "errors": {
      "loadFailed": "Échec du chargement des paramètres",
      "saveFailed": "Échec de l'enregistrement",
      "connectionFailed": "Échec de la connexion",
      "invalidApiKey": "Clé API invalide"
    },
    "status": {
      "downloadingVoice": "Téléchargement du modèle vocal..."
    }
  },
  "Setup": {
    "welcome": "Bienvenue sur CAAL",
    "stepOf": "Étape {current} sur {total}",
    "step1Title": "Choisissez votre fournisseur IA",
    "step2Title": "Choisissez votre voix",
    "step3Title": "Configurer les intégrations",
    "finishSetup": "Terminer la configuration"
  }
}
```

Note: Keep technical terms in English per CONTEXT.md: Ollama, Groq, Kokoro, Piper, STT, TTS, LLM, Home Assistant, n8n, API.
  </action>
  <verify>
    - `cat frontend/messages/en.json | wc -l` shows 100+ lines
    - `cat frontend/messages/fr.json | wc -l` shows 100+ lines
    - JSON is valid: `cd frontend && node -e "require('./messages/en.json'); require('./messages/fr.json'); console.log('Valid JSON')"`
  </verify>
  <done>Comprehensive EN/FR message files created with all UI strings organized by namespace</done>
</task>

<task type="auto">
  <name>Task 2: Localize settings panel and add language selector</name>
  <files>
    frontend/components/settings/settings-panel.tsx
  </files>
  <action>
Update settings-panel.tsx to use translations and add a language selector dropdown.

1. Add imports at the top:
   ```typescript
   import { useTranslations } from 'next-intl';
   import { toast } from 'sonner';
   ```

2. Inside the component, add translation hook:
   ```typescript
   const t = useTranslations('Settings');
   const tCommon = useTranslations('Common');
   ```

3. Add language selector constants (after existing constants):
   ```typescript
   const LANGUAGES = [
     { code: 'en', name: 'English' },
     { code: 'fr', name: 'Français' },
   ] as const;
   ```

4. Update TABS array to use translations (this must be inside the component since it uses t()):
   ```typescript
   const tabs: { id: TabId; label: string }[] = [
     { id: 'agent', label: t('tabs.agent') },
     { id: 'prompt', label: t('tabs.prompt') },
     { id: 'providers', label: t('tabs.providers') },
     { id: 'llm', label: t('tabs.llm') },
     { id: 'integrations', label: t('tabs.integrations') },
     { id: 'wake', label: t('tabs.wake') },
   ];
   ```

5. Add language change handler (handles save, cookie update, and reload):
   ```typescript
   const handleLanguageChange = async (newLocale: string) => {
     // Update local state
     setSettings({ ...settings, language: newLocale });

     // Save to backend
     try {
       await fetch('/api/settings', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ settings: { ...settings, language: newLocale } }),
       });

       // Update cookie for next request
       document.cookie = `CAAL_LOCALE=${newLocale};path=/;max-age=31536000`;

       // Show feedback then reload
       toast.success(t('language.updated'));
       setTimeout(() => window.location.reload(), 500);
     } catch {
       toast.error(t('errors.saveFailed'));
     }
   };
   ```

6. Add language selector to the Agent tab (at the top of renderAgentTab):
   ```tsx
   {/* Language selector */}
   <div className="space-y-2">
     <label className="text-sm font-medium">{t('language.label')}</label>
     <select
       value={settings.language}
       onChange={(e) => handleLanguageChange(e.target.value)}
       className="border-input bg-background w-full rounded-lg border px-4 py-3 text-sm"
     >
       {LANGUAGES.map((lang) => (
         <option key={lang.code} value={lang.code}>
           {lang.name}
         </option>
       ))}
     </select>
     <p className="text-muted-foreground text-xs">{t('language.description')}</p>
   </div>
   ```

7. Replace ALL hardcoded strings throughout the component with t() calls:

   Header:
   - "Settings" -> `{t('title')}`
   - "Loading settings..." -> `{tCommon('loading')}`

   Agent tab:
   - "Agent Name" -> `{t('agent.name')}`
   - "Voice" -> `{t('agent.voice')}`
   - "Wake Greetings" -> `{t('agent.wakeGreetings')}`
   - "(one per line)" -> `({t('agent.wakeGreetingsHint')})`

   Prompt tab:
   - "Default" -> `{t('prompt.default')}`
   - "Custom" -> `{t('prompt.custom')}`

   Providers tab:
   - "LLM Provider" -> `{t('providers.llmProvider')}`
   - "Host URL" -> `{t('providers.hostUrl')}`
   - "API Key" -> `{t('providers.apiKey')}`
   - "Model" -> `{t('providers.model')}`
   - "Select a model..." -> `{t('providers.selectModel')}`
   - "Test" -> `{tCommon('test')}`
   - "{N} models available" -> `{t('providers.modelsAvailable', { count: ollamaModels.length })}`
   - "Test connection to see all available models" -> `{t('providers.testConnectionToSee')}`
   - "Enter API key and test..." -> `{t('providers.enterApiKeyToSee')}`
   - "Get your API key at" -> `{t('providers.getApiKeyAt')}`
   - "STT Provider:" -> `{t('providers.sttProvider')}:`
   - "Speaches (local)" -> `{t('providers.speachesLocal')}`
   - "Groq Whisper" -> `{t('providers.groqWhisper')}`
   - "Automatically selected..." -> `{t('providers.sttProviderNote')}`
   - "TTS Provider" -> `{t('providers.ttsProvider')}`
   - "High-quality neural TTS..." -> `{t('providers.kokoroDesc')}`
   - "Lightweight CPU-friendly..." -> `{t('providers.piperDesc')}`

   LLM tab:
   - "Temperature" -> `{t('llm.temperature')}`
   - "Precise" -> `{t('llm.precise')}`
   - "Creative" -> `{t('llm.creative')}`
   - "Context Size" -> `{t('llm.contextSize')}`
   - "Max Turns" -> `{t('llm.maxTurns')}`
   - "Tool Cache Size" -> `{t('llm.toolCacheSize')}`
   - "Turn Detection" -> `{t('llm.turnDetection')}`
   - "Control how the agent detects..." -> `{t('llm.turnDetectionDesc')}`
   - "Allow Interruptions" -> `{t('llm.allowInterruptions')}`
   - "Interrupt the agent while speaking" -> `{t('llm.allowInterruptionsDesc')}`
   - "Endpointing Delay" -> `{t('llm.endpointingDelay')}`
   - "How long to wait..." -> `{t('llm.endpointingDelayDesc')}`

   Integrations tab:
   - "Home Assistant" -> `{t('integrations.homeAssistant')}`
   - "n8n" -> `{t('integrations.n8n')}`
   - "Long-lived Access Token" -> `{t('integrations.longLivedToken')}`
   - "Access Token" -> `{t('integrations.accessToken')}`
   - "Connected - {N} entities" -> `{t('integrations.connected')} - {t('integrations.entities', { count: result.device_count })}`
   - "/mcp-server/http will be appended automatically" -> `{t('integrations.mcpNote')}`

   Wake tab:
   - "Enable Wake Word" -> `{t('wake.enable')}`
   - "Wake Word Model" -> `{t('wake.model')}`
   - "Threshold" -> `{t('wake.threshold')}`
   - "Silence Timeout (s)" -> `{t('wake.silenceTimeout')}`

   Footer:
   - "Save Changes" -> `{tCommon('save')}`
   - "Saving..." -> `{tCommon('saving')}`
   - "Downloading voice model..." -> `{t('status.downloadingVoice')}`

   Errors:
   - "Failed to load settings" -> t('errors.loadFailed')
   - "Failed to save" -> t('errors.saveFailed')
   - "Connection failed" -> t('errors.connectionFailed')
   - "Invalid API key" -> t('errors.invalidApiKey')
  </action>
  <verify>
    - `grep -c "useTranslations" frontend/components/settings/settings-panel.tsx` returns 2 (Settings and Common)
    - `grep "CAAL_LOCALE" frontend/components/settings/settings-panel.tsx` shows cookie update code
    - `grep -c "t('" frontend/components/settings/settings-panel.tsx` shows 50+ translation calls
    - No hardcoded English strings remain (except technical terms like Ollama, Groq)
  </verify>
  <done>Settings panel fully localized with language selector that saves to backend, updates cookie, and reloads</done>
</task>

<task type="auto">
  <name>Task 3: Localize welcome view and setup wizard</name>
  <files>
    frontend/components/app/welcome-view.tsx
    frontend/components/setup/setup-wizard.tsx
    frontend/components/setup/provider-step.tsx
    frontend/components/setup/stt-step.tsx
    frontend/components/setup/integrations-step.tsx
  </files>
  <action>
1. Update `frontend/components/app/welcome-view.tsx`:
   - Add `'use client';` directive if not present
   - Import `useTranslations` from 'next-intl'
   - Add `const t = useTranslations('Welcome');`
   - Replace "Chat live with your voice AI agent" with `{t('subtitle')}`
   - Note: startButtonText is passed as prop, will be localized at call site

2. Update `frontend/components/setup/setup-wizard.tsx`:
   - Import `useTranslations` from 'next-intl'
   - Add at start of component:
     ```typescript
     const t = useTranslations('Setup');
     const tCommon = useTranslations('Common');
     ```
   - Update getStepTitle() to use translations:
     ```typescript
     const getStepTitle = () => {
       switch (step) {
         case 1: return t('step1Title');
         case 2: return t('step2Title');
         case 3: return t('step3Title');
         default: return '';
       }
     };
     ```
   - Replace header text:
     - "Welcome to CAAL" -> `{t('welcome')}`
     - "Step {step} of {TOTAL_STEPS}" -> `{t('stepOf', { current: step, total: TOTAL_STEPS })}`
   - Replace button text:
     - "Back" -> `{tCommon('back')}`
     - "Continue" -> `{tCommon('continue')}`
     - "Finish Setup" -> `{t('finishSetup')}`
     - "Saving..." -> `{tCommon('saving')}`
     - "Downloading voice model..." -> (reuse Settings.status.downloadingVoice or add to Setup)

3. Update `frontend/components/setup/provider-step.tsx`:
   - Import `useTranslations` from 'next-intl'
   - Add `const t = useTranslations('Settings.providers');`
   - Replace all hardcoded strings with t() calls (use same keys as settings panel)

4. Update `frontend/components/setup/stt-step.tsx`:
   - Import `useTranslations` from 'next-intl'
   - Add translation hooks
   - Replace hardcoded strings (voice selection, TTS provider labels)

5. Update `frontend/components/setup/integrations-step.tsx`:
   - Import `useTranslations` from 'next-intl'
   - Add `const t = useTranslations('Settings.integrations');`
   - Replace hardcoded strings with t() calls
  </action>
  <verify>
    - `grep "useTranslations" frontend/components/app/welcome-view.tsx` shows import and usage
    - `grep "useTranslations" frontend/components/setup/setup-wizard.tsx` shows import and usage
    - `grep "useTranslations" frontend/components/setup/provider-step.tsx` shows import and usage
    - `grep "useTranslations" frontend/components/setup/stt-step.tsx` shows import and usage
    - `grep "useTranslations" frontend/components/setup/integrations-step.tsx` shows import and usage
    - `cd frontend && pnpm build` completes without errors
  </verify>
  <done>Welcome view and setup wizard fully localized</done>
</task>

</tasks>

<verification>
1. `cd frontend && pnpm build` succeeds
2. Start app and verify English UI renders correctly
3. Open settings, change language to French, verify:
   - Toast shows "Langue mise a jour"
   - Page reloads
   - All settings labels now in French
   - Tabs in French
   - Welcome screen subtitle in French
4. Refresh page - French persists (cookie preserved)
5. Change back to English - UI returns to English
6. No console errors related to missing translations
</verification>

<success_criteria>
- messages/en.json has 100+ lines with all UI strings
- messages/fr.json has complete French translations
- settings-panel.tsx uses useTranslations with 50+ t() calls
- Language selector dropdown appears in Agent tab
- Language change saves to backend, updates CAAL_LOCALE cookie, reloads page
- welcome-view.tsx uses translations
- setup-wizard.tsx and step components use translations
- All user-visible text (except technical terms) is translated
- No TypeScript errors
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend-i18n/02-02-SUMMARY.md`
</output>
